<section id="content" role="main" class="group search section-page ancillary">

  <header class="page-header group">
    <hgroup>
      <h1><%= formatted_section_name @section.slug %></h1>
    </hgroup>
  </header>

  <div class="search-container group">
    <div class="results group">
      <div class="results-wrapper">
        <div class="summary">
          <%# This rescue is in place in the event that a section is
            # added without creating the relevant _section.html
            # description file. %>
          <%= begin; include @section.slug; rescue Exception => e; end %>
        </div>

        <div id="popular">
          <% if @popular && @popular.size > 0 %>
            <ul class="results-list">
              <% group_by_format(@popular).each do |presentation_format_name, results| %>
                <% results.each do |result| %>
                  <li class="type-<%= result.presentation_format %>">
                    <a href="<%= h result.link %>" title="View <%= h result.title %>"><%= h result.title %></a>
                    <% if result.description && !result.description.empty? %>
                      <p><%= h result.description %></p>
                    <% end %>
                  </li>
                <% end %>
              <% end %>
            </ul>
          <% end %>
        </div>

        <% @results.each do |slug, artefacts| %>
          <div class="hidden" id="<%= slug %>">
            <ul class="results-list">
              <% artefacts.each do |artefact| %>
                <li class="type-<%= artefact['format'].downcase %>">
                  <a href="<%= h artefact['web_url'] %>"
                     title="View <%= h artefact['title'] %>">
                    <%= h artefact['title'] %>
                  </a>
                  <p><%= h artefact['details']['overview'] %></p>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

    </div>
  </div>

  <aside class="filters">
    <div class="group">
      <h2 class="visuallyhidden">Current Section</h2>

      <ul>
        <li class="open">
          <a href="<%= @section.path %>"><%= formatted_section_name @section.slug %></a>
          <ul class="subsections">
            <% @raw_sections.each do |tag| %>
              <li data-filter="section-<%= tag["title"].downcase.gsub(" ", "-") %>"><a href="<%= @section.path %>#/<%= tag["title"].downcase.gsub(" ", "-") %>"><%= tag['title'] %></a></li>
            <% end %>
            <li data-filter="section-other %>"><a href="<%= @section.path %>#/other">Other</a></li>
          </ul>
        </li>
      </ul>

      <h2>Other sections</h2>

      <ul>
        <% @sections.each do |section| %>
          <li><a href="<%= section["web_url"] %>"><%= h section["title"] %></a></li>
        <% end %>
      </ul>
    </div>

  </aside>
  </div>
</section>

<% content_for :head do %>
  <link rel="alternate" type="application/json" href="/browse/<%= @section.slug %>.json">
<% end %>
